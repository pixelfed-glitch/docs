<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Migrate to the Pixelfed + Docker Compose v2 | Pixelfed Glitch Docs</title>
    <meta name="description" content="The Pixelfed Glitch documentation">
    <meta name="generator" content="VitePress v1.0.0-rc.39">
    <link rel="preload stylesheet" href="/docs/pr-preview/pr-1/assets/style.SA34fevS.css" as="style">
    
    <script type="module" src="/docs/pr-preview/pr-1/assets/app.hk4QAiCr.js"></script>
    <link rel="preload" href="/docs/pr-preview/pr-1/assets/inter-roman-latin.bvIUbFQP.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/docs/pr-preview/pr-1/assets/chunks/framework.wUJtDaaB.js">
    <link rel="modulepreload" href="/docs/pr-preview/pr-1/assets/chunks/theme.1AcbUgM7.js">
    <link rel="modulepreload" href="/docs/pr-preview/pr-1/assets/running-pixelfed_docker_migrate_v2.0.md.JtJSSBTP.lean.js">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon.png">
    <link rel="shortcut icon" href="/assets/favicon.png">
    <meta name="theme-color" content="#ffffff">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-9d8abc1e><!--[--><!--]--><!--[--><span tabindex="-1" data-v-c8291ffa></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-c8291ffa> Skip to content </a><!--]--><!----><header class="VPNav" data-v-9d8abc1e data-v-7ad780c2><div class="VPNavBar has-sidebar" data-v-7ad780c2 data-v-3efcd581><div class="wrapper" data-v-3efcd581><div class="container" data-v-3efcd581><div class="title" data-v-3efcd581><div class="VPNavBarTitle has-sidebar" data-v-3efcd581 data-v-e4cade88><a class="title" href="/docs/pr-preview/pr-1/" data-v-e4cade88><!--[--><!--]--><!--[--><!--[--><!--[--><img class="VPImage dark logo" src="/docs/pr-preview/pr-1/logo-white.png" alt data-v-ab19afbb><!--]--><!--[--><img class="VPImage light logo" src="/docs/pr-preview/pr-1/logo-black.png" alt data-v-ab19afbb><!--]--><!--]--><!--]--><!--[-->Docs (Next)<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-3efcd581><div class="content-body" data-v-3efcd581><!--[--><!--]--><div class="VPNavBarSearch search" data-v-3efcd581><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-3efcd581 data-v-f732b5d0><span id="main-nav-aria-label" class="visually-hidden" data-v-f732b5d0>Main Navigation</span><!--[--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://pixelfed-glitch.github.io" target="_blank" rel="noreferrer" tabindex="0" data-v-f732b5d0 data-v-cb318fec><!--[--><span data-v-cb318fec>pixelfed</span><!--]--></a><!--]--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://github.com/pixelfed-glitch/pixelfed/discussions" target="_blank" rel="noreferrer" tabindex="0" data-v-f732b5d0 data-v-cb318fec><!--[--><span data-v-cb318fec>Support</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-3efcd581 data-v-283b26e9><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-283b26e9 data-v-d80abb8e data-v-1c29e291><span class="check" data-v-1c29e291><span class="icon" data-v-1c29e291><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-d80abb8e><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-d80abb8e><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-3efcd581 data-v-ef6192dc data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/pixelfed" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-16cf740a><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink no-icon" href="https://discord.gg/MHvDHaSzmc" aria-label="discord" target="_blank" rel="noopener" data-v-e71e869c data-v-16cf740a><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Discord</title><path d="M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 01.0785.0095c.1202.099.246.1981.3728.2924a.077.077 0 01-.0066.1276 12.2986 12.2986 0 01-1.873.8914.0766.0766 0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 00-.0312-.0286zM8.02 15.3312c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9555-2.4189 2.157-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.9555 2.4189-2.1569 2.4189zm7.9748 0c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9554-2.4189 2.1569-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.946 2.4189-2.1568 2.4189Z"/></svg></a><a class="VPSocialLink no-icon" href="https://pixelfed.social/@pixelfed" aria-label target="_blank" rel="noopener" data-v-e71e869c data-v-16cf740a><svg width="20" height="20" version="1.1" id="svg161" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs165" /> <path d="M 10,20 C 4.4772,20 0,15.5228 0,10 0,4.4772 4.4772,0 10,0 15.5228,0 20,4.4772 20,10 20,15.5228 15.5228,20 10,20 Z M 9.206,12.1832 h 1.8344 c 1.728,0 3.1292,-1.364 3.1292,-3.046 0,-1.6824 -1.4008,-3.0464 -3.1292,-3.0464 H 8.3928 c -0.9968,0 -1.8052,0.7868 -1.8052,1.7576 v 6.84 z" fill-rule="evenodd" id="path159" style="stroke-width:0.4" /></svg></a><a class="VPSocialLink no-icon" href="https://mastodon.social/@pixelfed" aria-label="mastodon" target="_blank" rel="noopener" data-v-e71e869c data-v-16cf740a><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Mastodon</title><path d="M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792 0 11.813 0h-.03c-3.98 0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611.118 1.24.325 2.47.62 3.68.55 2.237 2.777 4.098 4.96 4.857 2.336.792 4.849.923 7.256.38.265-.061.527-.132.786-.213.585-.184 1.27-.39 1.774-.753a.057.057 0 0 0 .023-.043v-1.809a.052.052 0 0 0-.02-.041.053.053 0 0 0-.046-.01 20.282 20.282 0 0 1-4.709.545c-2.73 0-3.463-1.284-3.674-1.818a5.593 5.593 0 0 1-.319-1.433.053.053 0 0 1 .066-.054c1.517.363 3.072.546 4.632.546.376 0 .75 0 1.125-.01 1.57-.044 3.224-.124 4.768-.422.038-.008.077-.015.11-.024 2.435-.464 4.753-1.92 4.989-5.604.008-.145.03-1.52.03-1.67.002-.512.167-3.63-.024-5.545zm-3.748 9.195h-2.561V8.29c0-1.309-.55-1.976-1.67-1.976-1.23 0-1.846.79-1.846 2.35v3.403h-2.546V8.663c0-1.56-.617-2.35-1.848-2.35-1.112 0-1.668.668-1.67 1.977v6.218H4.822V8.102c0-1.31.337-2.35 1.011-3.12.696-.77 1.608-1.164 2.74-1.164 1.311 0 2.302.5 2.962 1.498l.638 1.06.638-1.06c.66-.999 1.65-1.498 2.96-1.498 1.13 0 2.043.395 2.74 1.164.675.77 1.012 1.81 1.012 3.12z"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-3efcd581 data-v-8e87c032 data-v-aa8de344><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-aa8de344><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-aa8de344><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-aa8de344><div class="VPMenu" data-v-aa8de344 data-v-e42ed9b3><!----><!--[--><!--[--><!----><div class="group" data-v-8e87c032><div class="item appearance" data-v-8e87c032><p class="label" data-v-8e87c032>Appearance</p><div class="appearance-action" data-v-8e87c032><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-8e87c032 data-v-d80abb8e data-v-1c29e291><span class="check" data-v-1c29e291><span class="icon" data-v-1c29e291><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-d80abb8e><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-d80abb8e><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-8e87c032><div class="item social-links" data-v-8e87c032><div class="VPSocialLinks social-links-list" data-v-8e87c032 data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/pixelfed" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-16cf740a><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink no-icon" href="https://discord.gg/MHvDHaSzmc" aria-label="discord" target="_blank" rel="noopener" data-v-e71e869c data-v-16cf740a><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Discord</title><path d="M20.317 4.3698a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-.1636-.3933-.4058-.8742-.6177-1.2495a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 00-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.0824.0824 0 00.0312.0561c2.0528 1.5076 4.0413 2.4228 5.9929 3.0294a.0777.0777 0 00.0842-.0276c.4616-.6304.8731-1.2952 1.226-1.9942a.076.076 0 00-.0416-.1057c-.6528-.2476-1.2743-.5495-1.8722-.8923a.077.077 0 01-.0076-.1277c.1258-.0943.2517-.1923.3718-.2914a.0743.0743 0 01.0776-.0105c3.9278 1.7933 8.18 1.7933 12.0614 0a.0739.0739 0 01.0785.0095c.1202.099.246.1981.3728.2924a.077.077 0 01-.0066.1276 12.2986 12.2986 0 01-1.873.8914.0766.0766 0 00-.0407.1067c.3604.698.7719 1.3628 1.225 1.9932a.076.076 0 00.0842.0286c1.961-.6067 3.9495-1.5219 6.0023-3.0294a.077.077 0 00.0313-.0552c.5004-5.177-.8382-9.6739-3.5485-13.6604a.061.061 0 00-.0312-.0286zM8.02 15.3312c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9555-2.4189 2.157-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.9555 2.4189-2.1569 2.4189zm7.9748 0c-1.1825 0-2.1569-1.0857-2.1569-2.419 0-1.3332.9554-2.4189 2.1569-2.4189 1.2108 0 2.1757 1.0952 2.1568 2.419 0 1.3332-.946 2.4189-2.1568 2.4189Z"/></svg></a><a class="VPSocialLink no-icon" href="https://pixelfed.social/@pixelfed" aria-label target="_blank" rel="noopener" data-v-e71e869c data-v-16cf740a><svg width="20" height="20" version="1.1" id="svg161" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"> <defs id="defs165" /> <path d="M 10,20 C 4.4772,20 0,15.5228 0,10 0,4.4772 4.4772,0 10,0 15.5228,0 20,4.4772 20,10 20,15.5228 15.5228,20 10,20 Z M 9.206,12.1832 h 1.8344 c 1.728,0 3.1292,-1.364 3.1292,-3.046 0,-1.6824 -1.4008,-3.0464 -3.1292,-3.0464 H 8.3928 c -0.9968,0 -1.8052,0.7868 -1.8052,1.7576 v 6.84 z" fill-rule="evenodd" id="path159" style="stroke-width:0.4" /></svg></a><a class="VPSocialLink no-icon" href="https://mastodon.social/@pixelfed" aria-label="mastodon" target="_blank" rel="noopener" data-v-e71e869c data-v-16cf740a><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Mastodon</title><path d="M23.268 5.313c-.35-2.578-2.617-4.61-5.304-5.004C17.51.242 15.792 0 11.813 0h-.03c-3.98 0-4.835.242-5.288.309C3.882.692 1.496 2.518.917 5.127.64 6.412.61 7.837.661 9.143c.074 1.874.088 3.745.26 5.611.118 1.24.325 2.47.62 3.68.55 2.237 2.777 4.098 4.96 4.857 2.336.792 4.849.923 7.256.38.265-.061.527-.132.786-.213.585-.184 1.27-.39 1.774-.753a.057.057 0 0 0 .023-.043v-1.809a.052.052 0 0 0-.02-.041.053.053 0 0 0-.046-.01 20.282 20.282 0 0 1-4.709.545c-2.73 0-3.463-1.284-3.674-1.818a5.593 5.593 0 0 1-.319-1.433.053.053 0 0 1 .066-.054c1.517.363 3.072.546 4.632.546.376 0 .75 0 1.125-.01 1.57-.044 3.224-.124 4.768-.422.038-.008.077-.015.11-.024 2.435-.464 4.753-1.92 4.989-5.604.008-.145.03-1.52.03-1.67.002-.512.167-3.63-.024-5.545zm-3.748 9.195h-2.561V8.29c0-1.309-.55-1.976-1.67-1.976-1.23 0-1.846.79-1.846 2.35v3.403h-2.546V8.663c0-1.56-.617-2.35-1.848-2.35-1.112 0-1.668.668-1.67 1.977v6.218H4.822V8.102c0-1.31.337-2.35 1.011-3.12.696-.77 1.608-1.164 2.74-1.164 1.311 0 2.302.5 2.962 1.498l.638 1.06.638-1.06c.66-.999 1.65-1.498 2.96-1.498 1.13 0 2.043.395 2.74 1.164.675.77 1.012 1.81 1.012 3.12z"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-3efcd581 data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><div class="divider" data-v-3efcd581><div class="divider-line" data-v-3efcd581></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-9d8abc1e data-v-b979e4d9><div class="container" data-v-b979e4d9><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-b979e4d9><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-b979e4d9><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-b979e4d9>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-b979e4d9 data-v-2744f6e0><button data-v-2744f6e0>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-9d8abc1e data-v-4871f9f5><div class="curtain" data-v-4871f9f5></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-4871f9f5><span class="visually-hidden" id="sidebar-aria-label" data-v-4871f9f5> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-4871f9f5><section class="VPSidebarItem level-0 is-link has-active" data-v-4871f9f5 data-v-bd01e0d5><div class="item" tabindex="0" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/pr-preview/pr-1/running-pixelfed/" data-v-bd01e0d5><!--[--><h2 class="text" data-v-bd01e0d5>Running Pixelfed</h2><!--]--></a><!----></div><div class="items" data-v-bd01e0d5><!--[--><section class="VPSidebarItem level-1 has-active" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" role="button" tabindex="0" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><h3 class="text" data-v-bd01e0d5>Docker</h3><!----></div><div class="items" data-v-bd01e0d5><!--[--><div class="VPSidebarItem level-2 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/pr-preview/pr-1/running-pixelfed/docker/prerequisites.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Prerequisites</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/pr-preview/pr-1/running-pixelfed/docker/installation.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Installation</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/pr-preview/pr-1/running-pixelfed/docker/customize.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Customize</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/pr-preview/pr-1/running-pixelfed/docker/faq.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>FAQ</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/pr-preview/pr-1/running-pixelfed/docker/runtimes.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Runtimes</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/pr-preview/pr-1/running-pixelfed/docker/migrate/v2.0.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Migrate to v2</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" role="button" tabindex="0" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><h3 class="text" data-v-bd01e0d5>Generic</h3><!----></div><div class="items" data-v-bd01e0d5><!--[--><div class="VPSidebarItem level-2 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/pr-preview/pr-1/running-pixelfed/generic/prerequisites.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Prerequisites</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/pr-preview/pr-1/running-pixelfed/generic/installation.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Installation</p><!--]--></a><!----></div><!----></div><!--]--></div></section><div class="VPSidebarItem level-1 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/pr-preview/pr-1/running-pixelfed/configuration.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Configuration</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/pr-preview/pr-1/running-pixelfed/administration.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Administration</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/pr-preview/pr-1/running-pixelfed/cli-cheatsheet.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>CLI Cheatsheet</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/pr-preview/pr-1/running-pixelfed/troubleshooting.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>Troubleshooting</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-4871f9f5><section class="VPSidebarItem level-0" data-v-4871f9f5 data-v-bd01e0d5><div class="item" role="button" tabindex="0" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><h2 class="text" data-v-bd01e0d5>Spec Compliance</h2><!----></div><div class="items" data-v-bd01e0d5><!--[--><div class="VPSidebarItem level-1 is-link" data-v-bd01e0d5 data-v-bd01e0d5><div class="item" data-v-bd01e0d5><div class="indicator" data-v-bd01e0d5></div><a class="VPLink link link" href="/docs/pr-preview/pr-1/spec/ActivityPub.html" data-v-bd01e0d5><!--[--><p class="text" data-v-bd01e0d5>ActivityPub</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-9d8abc1e data-v-3cf691b6><div class="VPDoc has-sidebar has-aside" data-v-3cf691b6 data-v-e6f2a212><!--[--><!--]--><div class="container" data-v-e6f2a212><div class="aside" data-v-e6f2a212><div class="aside-curtain" data-v-e6f2a212></div><div class="aside-container" data-v-e6f2a212><div class="aside-content" data-v-e6f2a212><div class="VPDocAside" data-v-e6f2a212 data-v-cb998dce><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-cb998dce data-v-6b52fe58><div class="content" data-v-6b52fe58><div class="outline-marker" data-v-6b52fe58></div><div class="outline-title" role="heading" aria-level="2" data-v-6b52fe58>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-6b52fe58><span class="visually-hidden" id="doc-outline-aria-label" data-v-6b52fe58> Table of Contents for current page </span><ul class="VPDocOutlineItem root" data-v-6b52fe58 data-v-53c99d69><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-cb998dce></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-e6f2a212><div class="content-container" data-v-e6f2a212><!--[--><!--]--><main class="main" data-v-e6f2a212><div style="position:relative;" class="vp-doc _docs_pr-preview_pr-1_running-pixelfed_docker_migrate_v2_0" data-v-e6f2a212><div><h1 id="migrate-to-the-pixelfed-docker-compose-v2" tabindex="-1">Migrate to the Pixelfed + Docker Compose v2 <a class="header-anchor" href="#migrate-to-the-pixelfed-docker-compose-v2" aria-label="Permalink to &quot;Migrate to the Pixelfed + Docker Compose v2&quot;">‚Äã</a></h1><p>There are <a href="https://github.com/pixelfed-glitch/pixelfed/pull/4844" target="_blank" rel="noreferrer"><em>a lot</em> of changes</a> in how Pixelfed Docker/Docker Compose images work - it&#39;s a complete rewrite - with a couple of breaking/significant changes.</p><p>But don&#39;t worry! This document and the <a href="#migration-steps">Migration Guide</a> further down covers all of the required changes and steps you need to safely migrate.</p><p>We don&#39;t take <em>breaking changes</em> or <em>lengthy migration guides</em> lightly, and future iterations and improvements will be either seamless or <em>much</em> smaller in scope and complexity.</p><p>We do however believe that the <em>many</em> improvements (listed below) are worth it, and sets us up for a brighter future for self-hosted and maintainable Pixelfed servers</p><h2 id="breaking-changes" tabindex="-1">Breaking Changes <a class="header-anchor" href="#breaking-changes" aria-label="Permalink to &quot;Breaking Changes&quot;">‚Äã</a></h2><div class="danger custom-block"><p class="custom-block-title">These changes are breaking, removing, or changing existing behavior from Docker Compose v1 and <em>requires</em> your attention and possibly some steps to fix.</p><p>The <a href="#migration-steps">Migration Guide</a> has step by step guide for most of these!</p></div><h3 id="new-dockerfile" tabindex="-1">New <code>Dockerfile</code> <span class="VPBadge danger"><!--[-->Breaking<!--]--></span> <a class="header-anchor" href="#new-dockerfile" aria-label="Permalink to &quot;New `Dockerfile` &lt;Badge type=&quot;danger&quot; text=&quot;Breaking&quot; /&gt;&quot;">‚Äã</a></h3><p>All <a href="./../runtimes.html">runtime variations</a> of Pixelfed on Docker are now build from a single <code>Dockerfile</code>, rather than the previously three.</p><p>Please see the <a href="./../runtimes.html">Docker Runtimes</a> and <a href="./../customize.html">Docker Customization</a> documentation for more information.</p><h3 id="new-docker-compose-file" tabindex="-1">New Docker Compose file <span class="VPBadge danger"><!--[-->Breaking<!--]--></span> <a class="header-anchor" href="#new-docker-compose-file" aria-label="Permalink to &quot;New Docker Compose file &lt;Badge type=&quot;danger&quot; text=&quot;Breaking&quot; /&gt;&quot;">‚Äã</a></h3><p>The <code>docker-compose.yml</code> file has been rewritten from the ground up to be provide better defaults and more flexible out of the box.</p><p>This mean that <em>most</em> things you would likely want to tweak can be controlled from your <code>.env</code> config file, like installing additional APT Packages, PECL/PHP extensions, changing PHP version, modifying PHP settings (such as <code>memory_limit</code>), disabling specific services, changing where data and config files are stored, and so on.</p><h3 id="new-env-env-docker-file" tabindex="-1">New <code>.env</code> / <code>.env.docker</code> file <span class="VPBadge danger"><!--[-->Breaking<!--]--></span> <a class="header-anchor" href="#new-env-env-docker-file" aria-label="Permalink to &quot;New `.env` / `.env.docker` file &lt;Badge type=&quot;danger&quot; text=&quot;Breaking&quot; /&gt;&quot;">‚Äã</a></h3><p>The starter <code>.env.docker</code> file has been <em>significantly</em> expanded with most of the Pixelfed settings available, along with many Docker Compose specific ones.</p><p>Your Pixelfed specific settings are (of course) unchanged, but you need to configure them again after copying the new <code>.env.docker</code> file.</p><h3 id="using-bind-volumes" tabindex="-1">Using <code>bind</code> volumes <span class="VPBadge danger"><!--[-->Breaking<!--]--></span> <a class="header-anchor" href="#using-bind-volumes" aria-label="Permalink to &quot;Using `bind` volumes &lt;Badge type=&quot;danger&quot; text=&quot;Breaking&quot; /&gt;&quot;">‚Äã</a></h3><p>The old <code>docker-compose.yml</code> configuration file <a href="https://github.com/pixelfed-glitch/pixelfed/blob/b1ff44ca2f75c088a11576fb03b5bad2fbed4d5c/docker-compose.yml#L72-L76" target="_blank" rel="noreferrer">declared four anonymous Docker volumes</a> for storing Pixelfed related data within.</p><p>These are no longer used, instead favoring a <a href="https://docs.docker.com/storage/bind-mounts/" target="_blank" rel="noreferrer">Docker bind volume</a> approach where content is stored directly on the server disk, outside of a Docker volume.</p><p>The consequence of this change is that <em>all</em> data stored in the - now unsupported - Docker volumes will no longer be accessible by Pixelfed.</p><ul><li>The <code>db-data</code> volume <em>definitely</em> contains important data - it&#39;s your database, after all!</li><li>The <code>app-storage</code> volume <em>definitely</em> contains important data - it&#39;s files uploaded to - or seen by - your server!</li><li>The <code>redis-data</code> volume <em>might</em> contain important data (depending on your configuration)</li><li>The <code>app-bootstrap</code> volume does not contain any important data - all of it will be generated automatically in the new setup on startup. We will <em>not</em> be migrating this!</li></ul><div class="tip custom-block"><p class="custom-block-title">Please see the <a href="#migration-steps">Migration steps</a> section for information on moving your data.</p></div><h3 id="no-docker-networks" tabindex="-1">No Docker networks <span class="VPBadge danger"><!--[-->Breaking change<!--]--></span> <a class="header-anchor" href="#no-docker-networks" aria-label="Permalink to &quot;No Docker networks &lt;Badge type=&quot;danger&quot; text=&quot;Breaking change&quot; /&gt;&quot;">‚Äã</a></h3><p>The <code>docker-compose.yml</code> no longer include any custom networks, instead favoring the simplicity of the default <code>bridge</code> network.</p><p>The published ports can be configured via your <code>.env</code> file, look for the <code>DOCKER_*_HOST_PORT</code> keys.</p><h2 id="changes-needing-attention" tabindex="-1">Changes needing attention <a class="header-anchor" href="#changes-needing-attention" aria-label="Permalink to &quot;Changes needing attention&quot;">‚Äã</a></h2><div class="warning custom-block"><p class="custom-block-title">These changes are mostly informational and unlikely to cause any issues during upgrade, but included for visibility and in case your specific set up require them to be changed.</p></div><h3 id="new-redis-version" tabindex="-1">New Redis version <span class="VPBadge warning"><!--[-->Attention needed<!--]--></span> <a class="header-anchor" href="#new-redis-version" aria-label="Permalink to &quot;New Redis version &lt;Badge type=&quot;warning&quot; text=&quot;Attention needed&quot; /&gt;&quot;">‚Äã</a></h3><p>Redis has been upgraded from using the last version <code>5</code> release to using the latest <code>7.2</code> version instead - favoring the <code>debian</code> variant instead of <code>alpine</code>.</p><p>The Redis version can be controlled in your <code>.env</code> file via <code>DOCKER_REDIS_VERSION</code>.</p><p>If you want to keep using the Redis version set <code>DOCKER_REDIS_VERSION=&quot;5-alpine&quot;</code> in your <code>.env</code> file.</p><p>If you want to use <code>7.2</code> but the alpine variant, simply append <code>-alpine</code> to the <code>DOCKER_REDIS_VERSION</code> (e.g. <code>DOCKER_REDIS_VERSION=7.2-alpine</code>).</p><h3 id="pinned-mariadb-version" tabindex="-1">Pinned MariaDB version <span class="VPBadge warning"><!--[-->Attention needed<!--]--></span> <a class="header-anchor" href="#pinned-mariadb-version" aria-label="Permalink to &quot;Pinned MariaDB version &lt;Badge type=&quot;warning&quot; text=&quot;Attention needed&quot; /&gt;&quot;">‚Äã</a></h3><p>The included <code>db</code> service is now pinned to MariaDB <code>11.2</code> instead of <code>latest</code>.</p><p>You can revert to the previous setting by setting <code>DB_VERSION=&quot;latest&quot;</code> in your <code>.env</code> file.</p><h3 id="automatic-one-time-setup-tasks" tabindex="-1">Automatic &quot;One-time setup tasks&quot; <span class="VPBadge warning"><!--[-->Attention needed<!--]--></span> <a class="header-anchor" href="#automatic-one-time-setup-tasks" aria-label="Permalink to &quot;Automatic &quot;One-time setup tasks&quot; &lt;Badge type=&quot;warning&quot; text=&quot;Attention needed&quot; /&gt;&quot;">‚Äã</a></h3><p>This is also covered in the <a href="#migration-steps">migration guide</a> but existing Pixelfed instances need to disable the automatic run of <a href="./../../generic/installation.html#one-time-setup-tasks">One-time setup tasks</a> by setting <code>DOCKER_APP_RUN_ONE_TIME_SETUP_TASKS=0</code> in your <code>.env</code> file.</p><p>Your container <em>will</em> fail to start up if these are already configured for your site.</p><h2 id="new-or-improved-features" tabindex="-1">New or improved features <a class="header-anchor" href="#new-or-improved-features" aria-label="Permalink to &quot;New or improved features&quot;">‚Äã</a></h2><div class="tip custom-block"><p class="custom-block-title">All the new and exciting features and capabilities. üöÄ</p><p>This is where we hope we can convince you that the breaking changes and migration work was worth it ‚ù§Ô∏è</p></div><h3 id="nginx-proxy-service" tabindex="-1">Nginx Proxy service <span class="VPBadge tip"><!--[-->New<!--]--></span> <a class="header-anchor" href="#nginx-proxy-service" aria-label="Permalink to &quot;Nginx Proxy service &lt;Badge type=&quot;tip&quot; text=&quot;New&quot; /&gt;&quot;">‚Äã</a></h3><p>The new <code>docker-compose.yml</code> includes an <em>optional</em> (but enabled by default) Nginx Proxy for SSL/TLS termination.</p><p>Please see <a href="./../faq.html#how-do-i-use-my-own-proxy-server"><code>How do I use my own Proxy server?</code></a> and <code>DOCKER_PROXY_*</code> keys in the <code>.env</code> file for more information.</p><h3 id="letsencrypt-acme-service" tabindex="-1">LetsEncrypt/ACME service <span class="VPBadge tip"><!--[-->New<!--]--></span> <a class="header-anchor" href="#letsencrypt-acme-service" aria-label="Permalink to &quot;LetsEncrypt/ACME service &lt;Badge type=&quot;tip&quot; text=&quot;New&quot; /&gt;&quot;">‚Äã</a></h3><p>The new <code>docker-compose.yml</code> includes an <em>optional</em> (but enabled by default) ACME/LetsEncrypt service that when combined with the new Nginx Proxy automatically creates and maintains your SSL/TLS certificates.</p><p>Please see <a href="./../faq.html#how-do-i-use-my-own-ssl-certificate"><code>How do I use my own SSL certificate?</code></a> and <code>DOCKER_PROXY_*</code> + <code>LETSENCRYPT_*</code> keys in the <code>.env</code> file for more information.</p><h3 id="automatic-run-of-one-time-setup-tasks" tabindex="-1">Automatic run of &quot;One-time setup tasks&quot; <span class="VPBadge tip"><!--[-->New<!--]--></span> <a class="header-anchor" href="#automatic-run-of-one-time-setup-tasks" aria-label="Permalink to &quot;Automatic run of &quot;One-time setup tasks&quot; &lt;Badge type=&quot;tip&quot; text=&quot;New&quot; /&gt;&quot;">‚Äã</a></h3><p>When you set up a new Pixelfed server, there is handful of commands you need to run once (and only once) - these are called <a href="./../../generic/installation.html#one-time-setup-tasks">One-time setup tasks</a>.</p><p>These steps are now automatically run for you when <a href="./../installation.html">creating a new Pixelfed server</a>.</p><h3 id="extensive-documentation" tabindex="-1">Extensive documentation <span class="VPBadge tip"><!--[-->New<!--]--></span> <a class="header-anchor" href="#extensive-documentation" aria-label="Permalink to &quot;Extensive documentation &lt;Badge type=&quot;tip&quot; text=&quot;New&quot; /&gt;&quot;">‚Äã</a></h3><p>How to run and use the new Docker setup has been documented extensively. Not only on <em>this</em> page, but also in all the new scripts, <code>Dockerfile</code>, and <code>.env.docker</code> file.</p><p>We hope this will make it much easier to confidently and comfortably run your Pixelfed server with Docker - and when things <em>do</em> go wrong, the debugging and fixing of the issue much easier and quicker.</p><h3 id="automatic-publishing-of-docker-images" tabindex="-1">Automatic publishing of Docker images <span class="VPBadge tip"><!--[-->Improved<!--]--></span> <a class="header-anchor" href="#automatic-publishing-of-docker-images" aria-label="Permalink to &quot;Automatic publishing of Docker images &lt;Badge type=&quot;tip&quot; text=&quot;Improved&quot; /&gt;&quot;">‚Äã</a></h3><p>Going forward we will automatically build and push Docker images for Pixelfed to <s>both <a href="https://hub.docker.com/r/pixelfed/pixelfed" target="_blank" rel="noreferrer">Docker Hub</a> and</s> <a href="https://github.com/pixelfed-glitch/pixelfed/pkgs/container/pixelfed" target="_blank" rel="noreferrer">GitHub Container Registry</a>.</p><p>We will automatically be pushing all combinations of <a href="./../runtimes.html">our supported Docker runtimes</a> and PHP version (8.1, 8.2 and soon 8.3).</p><p>Further more, testing Pull Requests has never been easier, as we will also build and push Docker images for all Pull Requests with tag prefix <code>pr-{ID}</code> (e.x. <code>pixelfed/pixelfed:pr-4844-apache-8.2</code>).</p><p>You can control which Pixelfed release you use via the <code>DOCKER_APP_RELEASE</code> key/value pair in your <code>.env</code> file.</p><h3 id="customizable-dockerfile" tabindex="-1">Customizable <code>Dockerfile</code> <span class="VPBadge tip"><!--[-->New<!--]--></span> <a class="header-anchor" href="#customizable-dockerfile" aria-label="Permalink to &quot;Customizable `Dockerfile` &lt;Badge type=&quot;tip&quot; text=&quot;New&quot; /&gt;&quot;">‚Äã</a></h3><p>It&#39;s now possible to tweak many Docker related settings without copying or forking Pixelfed Dockerfile!</p><p>The new Dockerfile has many <a href="./../customize.html#build-settings-arguments">Build Arguments</a> (e.g., <code>--build-arg</code>) allowing you to easily</p><ul><li><a href="./../customize.html#php_version">Change your PHP version</a></li><li><a href="./../customize.html#php_pecl_extensions">Install extra PECL extensions</a></li><li><a href="./../customize.html#php_extensions">Install extra PHP extensions</a></li><li><a href="./../customize.html#apt_packages_extra">Install extra APT packages</a></li><li><a href="./../customize.html#php_debian_release">Change Debian version</a></li></ul><p>All of these (and more) settings are controlled from your <code>.env</code> file, and you simply need to run <code>docker compose build</code> to build your own bespoke version of Pixelfed on your server!</p><h3 id="customizable-entrypoint" tabindex="-1">Customizable <code>ENTRYPOINT</code> <span class="VPBadge tip"><!--[-->New<!--]--></span> <a class="header-anchor" href="#customizable-entrypoint" aria-label="Permalink to &quot;Customizable `ENTRYPOINT` &lt;Badge type=&quot;tip&quot; text=&quot;New&quot; /&gt;&quot;">‚Äã</a></h3><p>Do you want to <a href="./../customize.html#run-script-on-startup">run a script on container start up?</a> Or perhaps to <a href="./../customize.html#disabling-entrypoint-or-individual-scripts">disable a specific init script?</a> Or even <a href="./../customize.html#disabling-entrypoint-or-individual-scripts">disable all of the init scripts?</a></p><p>Now you can! And like with all the other settings it&#39;s just a setting in your <code>.env</code> file!</p><h3 id="templating-files" tabindex="-1">Templating files <span class="VPBadge tip"><!--[-->New<!--]--></span> <a class="header-anchor" href="#templating-files" aria-label="Permalink to &quot;Templating files &lt;Badge type=&quot;tip&quot; text=&quot;New&quot; /&gt;&quot;">‚Äã</a></h3><p>The new <code>ENTRYPOINT</code> system offers an <a href="./../customize.html#templating">extensible and flexible way for you to template configuration files</a> such as your <code>php.ini</code> during container start up.</p><p>The templating system has access to all settings from your <code>.env</code> file, and you can <a href="./../customize.html#file-path-examples">easily add your own templates!</a></p><h3 id="automatic-php-web-server-configuration" tabindex="-1">Automatic PHP/Web server configuration <span class="VPBadge tip"><!--[-->New<!--]--></span> <a class="header-anchor" href="#automatic-php-web-server-configuration" aria-label="Permalink to &quot;Automatic PHP/Web server configuration &lt;Badge type=&quot;tip&quot; text=&quot;New&quot; /&gt;&quot;">‚Äã</a></h3><p>Thanks to the new <a href="./../customize.html#templating">templating system</a> we now automatically calculate and configure required PHP / Web server settings for you - using your <code>.env</code> settings - such as</p><ul><li>(php.ini) <code>upload_max_filesize</code> with this formula <code>(MAX_PHOTO_SIZE * MAX_ALBUM_LENGTH) + BUFFER</code></li><li>(php.ini) <code>post_max_size</code> with this formula <code>(MAX_PHOTO_SIZE * MAX_ALBUM_LENGTH) + BUFFER</code></li><li>(php.ini) <code>max_file_uploads</code> using <code>MAX_ALBUM_LENGTH</code></li><li>(php.ini) <code>memory_limit</code> using <code>PHP_MEMORY_LIMIT</code></li><li>(php.ini) <code>[Date]date.timezone</code> using <code>APP_TIMEZONE</code></li></ul><h3 id="permission-auto-fixing" tabindex="-1">Permission auto-fixing <span class="VPBadge tip"><!--[-->New<!--]--></span> <a class="header-anchor" href="#permission-auto-fixing" aria-label="Permalink to &quot;Permission auto-fixing &lt;Badge type=&quot;tip&quot; text=&quot;New&quot; /&gt;&quot;">‚Äã</a></h3><p>If your installation for some reason has issues with permissions to files/directories, you can now automatically <a href="./../customize.html#fixing-ownership-on-startup">fix ownership and permissions on start up</a>.</p><p>This is an opt-in feature.</p><h3 id="faster-docker-image-building" tabindex="-1">Faster Docker image building <span class="VPBadge tip"><!--[-->Improved<!--]--></span> <a class="header-anchor" href="#faster-docker-image-building" aria-label="Permalink to &quot;Faster Docker image building &lt;Badge type=&quot;tip&quot; text=&quot;Improved&quot; /&gt;&quot;">‚Äã</a></h3><p>We now utilize <a href="https://docs.docker.com/build/buildkit/" target="_blank" rel="noreferrer">BuildKit</a>, <a href="https://docs.docker.com/build/cache/backends/" target="_blank" rel="noreferrer">layer caching</a>, <a href="https://docs.docker.com/build/building/multi-stage/" target="_blank" rel="noreferrer">multi-stage</a>, and <a href="https://docs.docker.com/build/building/multi-platform/" target="_blank" rel="noreferrer">multi-platform</a> to <em>really</em> speed up the building of Docker images.</p><p>Under ideal conditions, a <code>docker compose build</code> can now complete in less than a minute for most PHP changes. This of course also improve the speed of building Docker images in GitHub Actions and CI!</p><h3 id="fork-friendly-docker-releasing" tabindex="-1">Fork friendly Docker releasing <span class="VPBadge tip"><!--[-->New<!--]--></span> <a class="header-anchor" href="#fork-friendly-docker-releasing" aria-label="Permalink to &quot;Fork friendly Docker releasing &lt;Badge type=&quot;tip&quot; text=&quot;New&quot; /&gt;&quot;">‚Äã</a></h3><p>Forks of Pixelfed that have enabled GitHub Actions should <em>automatically</em> have the same Docker build + push experience as pixelfed/pixelfed have.</p><p>The <code>docker</code> workflow will by default build + push to the GitHub Container Registry for the project the commit was made to, meaning any downstream projects will not have to fork or modify their <code>docker</code> workflow to have a reliable release proccess.</p><p>Forks can further more set GitHub Actions Project variables <code>DOCKER_HUB_USERNAME</code>, <code>DOCKER_HUB_ORGANISATION</code>, <code>DOCKER_HUB_REPO</code> and <code>DOCKER_HUB_TOKEN</code> for automatic pushing of images to Docker Hub as well. Please see the <code>.github/workflows/docker.yml</code> file for more information.</p><h2 id="migration-steps" tabindex="-1">Migration steps <a class="header-anchor" href="#migration-steps" aria-label="Permalink to &quot;Migration steps&quot;">‚Äã</a></h2><div class="info custom-block"><p class="custom-block-title">INFO</p><p>This is a best-effort guide to help migrate off the old system. The operation is potentially complicated (and risky), so please be careful!</p></div><div class="danger custom-block"><p class="custom-block-title">DANGER</p><p><em><strong>PLEASE MAKE SURE TO BACKUP YOUR SERVER AND DATA BEFORE ATTEMPTING A MIGRATION</strong></em></p><p><strong>YOUR INSTANCE WILL BE <em>DOWN</em> WHILE DOING THE MIGRATION; PLEASE PLAN ACCORDINGLY; DEPENDING ON DATA SIZE IT COULD TAKE ANYWHERE FROM 5 <em>MINUTES</em> TO 5 <em>HOURS</em></strong></p></div><h3 id="_1-backup" tabindex="-1">1) Backup <a class="header-anchor" href="#_1-backup" aria-label="Permalink to &quot;1) Backup&quot;">‚Äã</a></h3><ol><li>Make sure to back up your server (ideally <em>after</em> step 1 below has been completed, but <em>before</em> is better than not at all!)</li><li>Capture the current Git version / Pixelfed release you are on (e.g., <code>git --no-pager log -1</code> outputs the commit reference as the 2nd word in the first line)</li><li>Backup your <code>.env</code> file (we will do this in step 3 as well)</li><li>Backup your <code>docker-compose.yml</code> file (<code>cp docker-compose.yml docker-compose.yml.old</code>)</li><li>Read through the <em>entire</em> document before starting</li></ol><h3 id="_2-migrate-env-file" tabindex="-1">2) Migrate <code>.env</code> file <a class="header-anchor" href="#_2-migrate-env-file" aria-label="Permalink to &quot;2) Migrate `.env` file&quot;">‚Äã</a></h3><p>The new <code>.env</code> file for Docker is a bit different from the old one (many new settings!) so the easiest is to grab the new <code>.env.docker</code> file and modify it from scratch again.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .env</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .env.old</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wget</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -O</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .env.new</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://raw.githubusercontent.com/pixelfed/pixelfed/dev/.env.docker</span></span></code></pre></div><p>Then open your old <code>.env.old</code> configuration file, and for each of the key/value pairs within it, find and update the key in the new <code>.env.new</code> configuration file.</p><p>Don&#39;t worry, though; the file might <em>look</em> different (and significantly larger), but it behaves <em>exactly</em> the way the old file did; it just has way more options!</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Don&#39;t worry if a key is missing in <code>.env.new</code>; you can add those key/value pairs back to the new file - ideally in the <code>Other configuration</code> section near the end of the file - but anywhere <em>should</em> be fine.</p></div><p>This is a great time to review your settings and familiarize yourself with all the new ones.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>In <em>particular</em> the following sections</p><ul><li><code>PHP configuration</code> section (near the end of the file) where <ul><li>The <code>DOCKER_APP_PHP_VERSION</code> settings control your PHP version</li><li>The <code>PHP_MEMORY_LIMIT</code> settings control your PHP memory limit</li></ul></li><li><code>Docker Specific configuration</code> section (near the end of the file) where <ul><li>The <code>DOCKER_ALL_HOST_DATA_ROOT_PATH</code> setting dictates where the newly migrated data will live.</li><li>The <code>DOCKER_APP_RUN_ONE_TIME_SETUP_TASKS</code> controls whether the <code>One-time setup tasks</code> should run. We do <em>not</em> want this since your Pixelfed instance is already set up!</li></ul></li><li><a href="./../faq.html">Frequently Asked Question / FAQ</a><ul><li><a href="./../faq.html#how-do-i-use-my-own-proxy-server">How do I use my own Proxy server?</a></li><li><a href="./../faq.html#how-do-i-use-my-own-ssl-certificate">How do I use my own SSL certificate?</a></li></ul></li></ul></div><h3 id="_3-stop-containers" tabindex="-1">3) Stop containers <a class="header-anchor" href="#_3-stop-containers" aria-label="Permalink to &quot;3) Stop containers&quot;">‚Äã</a></h3><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>This will take your Pixelfed instance offline</p></div><p>Stop <em>all</em> running containers (web, worker, redis, db)</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> down</span></span></code></pre></div><h3 id="_4-update-source-code" tabindex="-1">4) Update source code <a class="header-anchor" href="#_4-update-source-code" aria-label="Permalink to &quot;4) Update source code&quot;">‚Äã</a></h3><p>Update your project to the latest release of Pixelfed by running:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> origin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $release</span></span></code></pre></div><div class="info custom-block"><p class="custom-block-title">INFO</p><p>The <code>$release</code> can be any valid git reference like <code>dev,</code> <code>staging</code>, or a <a href="https://github.com/pixelfed-glitch/pixelfed/releases" target="_blank" rel="noreferrer">tagged release</a> such as <code>v0.12.0</code>.</p></div><h3 id="_5-migrate-data" tabindex="-1">5) Migrate data <a class="header-anchor" href="#_5-migrate-data" aria-label="Permalink to &quot;5) Migrate data&quot;">‚Äã</a></h3><p>The migration guide temporarily branches into two paths here:</p><ul><li><a href="#a-anonymous-volumes"><strong>Path A</strong></a> if you used Docker Anonymous Volumes.</li><li><a href="#b-bindhost-volumes"><strong>Path B</strong></a> if you used host/bind volumes.</li></ul><div class="tip custom-block"><p class="custom-block-title">Which Docker volume type am I using?</p><p>If your old <code>docker-compose.yml</code> had a <code>volumes</code> configuration section like below, you used should follow <a href="#a-anonymous-volumes">Path A</a>.</p><p>This is also what the v1 <code>docker-compose.yml</code> file for pixelfed/pixelfed used.</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">volumes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  db-data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  redis-data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  app-storage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  app-bootstrap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span></code></pre></div></div><h4 id="a-anonymous-volumes" tabindex="-1">A) Anonymous volumes <a class="header-anchor" href="#a-anonymous-volumes" aria-label="Permalink to &quot;A) Anonymous volumes&quot;">‚Äã</a></h4><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p><strong>It&#39;s important to note that this is a <em>copy</em> operation - so disk usage will (temporarily) double while you migrate</strong></p><p>We provide a &quot;migration container&quot; for your convenience that can access both the new and old volumes, allowing you to copy the data into the setup.</p><p>You can use <code>mv</code> (move files) instead of <code>rsync</code> in the guide below - but this is a be a <em>destructive</em> action, so you can&#39;t quickly roll back to your old setup, as the data no longer exists in the anonymous Docker volumes.</p></div><h5 id="a1-run-migration-container" tabindex="-1">A1) Run migration container <a class="header-anchor" href="#a1-run-migration-container" aria-label="Permalink to &quot;A1) Run migration container&quot;">‚Äã</a></h5><p>You can access the Docker container with both old and new volumes by running the following command:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compose</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-compose.migrate.yml</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> migrate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bash</span></span></code></pre></div><p>This will put you in the <code>/migrate</code> directory within the container, containing 9 directories like shown here:</p><div class="language-plain vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">plain</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>|-- app-storage</span></span>
<span class="line"><span>|   |-- new</span></span>
<span class="line"><span>|   `-- old</span></span>
<span class="line"><span>|-- db-data</span></span>
<span class="line"><span>|   |-- new</span></span>
<span class="line"><span>|   `-- old</span></span>
<span class="line"><span>`-- redis-data</span></span>
<span class="line"><span>    |-- new</span></span>
<span class="line"><span>    `-- old</span></span></code></pre></div><h5 id="a2-check-old-folders" tabindex="-1">A2) Check old folders <a class="header-anchor" href="#a2-check-old-folders" aria-label="Permalink to &quot;A2) Check old folders&quot;">‚Äã</a></h5><p>First thing we want to do is to check if the data inside the container looks correct!</p><p>The following commands should all return <em>SOME</em> files and data - if they do not - then there might be an issue with the anonymous volume binding.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>The content of the old folders may not be <em>exactly</em> whats show in the examples below - if a couple of the files or folders match, it&#39;s extremely likely it&#39;s correct!</p></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ls</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app-storage/old</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">app</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  debugbar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  framework</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  logs</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">oauth-private.key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  oauth-public.key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  purify</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Redis data might also be entirely empty, thats *okay*</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ls</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> redis-data/old</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">appendonlydir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server.pid</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ls</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db-data/old</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">aria_log_control</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  ddl_recovery-backup.log</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  ib_buffer_pool</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  ib_logfile0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ibdata1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  mariadb_upgrade_info</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  multi-master.info</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  mysql</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">performance_schema</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  pixelfed_prod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  sys</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  undo001</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  undo002</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  undo003</span></span></code></pre></div><h5 id="a3-check-new-folders" tabindex="-1">A3) Check new folders <a class="header-anchor" href="#a3-check-new-folders" aria-label="Permalink to &quot;A3) Check new folders&quot;">‚Äã</a></h5><p>The following commands should all return <em>NO</em> files and data - if they contain data - you need to delete it (backup first!) or skip that migration step.</p><p>If you haven&#39;t run <code>docker compose up</code> since you updated your project in step (2) - they should be empty and good to go.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ls</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app-storage/new</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ls</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db-data/new</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ls</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> redis-data/new</span></span></code></pre></div><h5 id="a4-copy-data" tabindex="-1">A4) Copy data <a class="header-anchor" href="#a4-copy-data" aria-label="Permalink to &quot;A4) Copy data&quot;">‚Äã</a></h5><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>This is where we potentially will double your disk usage (temporarily)</p></div><p>Now we will copy the data from the old volumes to the new ones.</p><p>The migration container has <a href="https://www.digitalocean.com/community/tutorials/how-to-use-rsync-to-sync-local-and-remote-directories" target="_blank" rel="noreferrer"><code>rsync</code></a> installed - which is perfect for that kind of work!</p><p><strong>NOTE</strong> It&#39;s important that the &quot;source&quot; (first path in the <code>rsync</code> command) has a trailing <code>/</code> - otherwise, the directory layout will turn out wrong!</p><p><strong>NOTE</strong> Depending on your server, these commands might take some time to finish; each command should provide a progress bar with a rough time estimation.</p><p><strong>NOTE</strong> <code>rsync</code> should preserve ownership, permissions, and symlinks correctly for you and all the files copied.</p><p>Let&#39;s copy the data by running the following commands:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rsync</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -avP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app-storage/old/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app-storage/new</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rsync</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -avP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db-data/old/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db-data/new</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rsync</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -avP</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> redis-data/old/</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> redis-data/new</span></span></code></pre></div><h5 id="a5-sanity-checking" tabindex="-1">A5) Sanity checking <a class="header-anchor" href="#a5-sanity-checking" aria-label="Permalink to &quot;A5) Sanity checking&quot;">‚Äã</a></h5><p>Let&#39;s make sure everything is copied over successfully!</p><p>Each <em>new</em> directory should contain <em>something</em> like (but not always exactly) the following - <strong>NO</strong> directory should have a single folder called <code>old</code>; if they do, the <code>rsync</code> commands above didn&#39;t work correctly - and you need to move the content of the <code>old</code> folder into the &quot;root&quot; of the <code>new</code> folder like shown a bit in the following sections.</p><p>The <strong>redis-data/new</strong> directory might also contain a <code>server.pid</code></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ls</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> redis-data/new</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">appendonlydir</span></span></code></pre></div><p>The <strong>app-storage/new</strong> directory should look <em>something</em> like this</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ls</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> app-storage/new</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">app</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  debugbar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  framework</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  logs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  oauth-private.key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  oauth-public.key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  purify</span></span></code></pre></div><p>The <strong>db-data/new</strong> directory should look <em>something</em> like this. There might be a lot of files or very few files, but there <em>must</em> be a <code>mysql</code>, <code>performance_schema</code>, and <code>${DB_DATABASE}</code> (e.g., <code>pixelfed_prod</code> directory)</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ls</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db-data/new</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">aria_log_control</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  ddl_recovery-backup.log</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  ib_buffer_pool</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  ib_logfile0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  ibdata1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  mariadb_upgrade_info</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  multi-master.info</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  mysql</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  performance_schema</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  pixelfed_prod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  sys</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  undo001</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  undo002</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  undo003</span></span></code></pre></div><p>If everything looks good, type <code>exit</code> to leave the migration container.</p><h4 id="b-bind-host-volumes" tabindex="-1">B) Bind/Host volumes <a class="header-anchor" href="#b-bind-host-volumes" aria-label="Permalink to &quot;B) Bind/Host volumes&quot;">‚Äã</a></h4><p>If you used Bind/Host volumes, then this guide can&#39;t offer any hard step-by-step guide to move your data, but instead will let you know how things would look if you started from scratch, so you can mirror or change this behavior.</p><p>In your <code>.env</code> file, the following KEY/VALUE pairs controls where your data and config files will go - please review each and make sure your files are in these paths, or adjust them to fit your current layout.</p><div class="tip custom-block"><p class="custom-block-title">You can see in the <code>docker-compose.yml</code> file for each <code>service volume</code> section how they are used.</p></div><ul><li><p><code>DOCKER_ALL_HOST_DATA_ROOT_PATH</code> - The &quot;root&quot; path for all service data.</p><p>Default: <code>./docker-compose-state/data</code></p></li><li><p><code>DOCKER_ALL_HOST_CONFIG_ROOT_PATH</code> - The &quot;root&quot; path for all service configs.</p><p>Default: <code>./docker-compose-state/config</code></p></li><li><p><code>DOCKER_APP_HOST_STORAGE_PATH</code> (<code>/var/www/storage</code>) - Path for Pixelfed <code>storage</code>, e.x., uploads by users, emojis, and such</p><p>Default: <code>${DOCKER_ALL_HOST_DATA_ROOT_PATH}/pixelfed/storage</code></p></li><li><p><code>DOCKER_APP_HOST_CACHE_PATH</code> (<code>/var/www/bootstrap/cache</code>)</p><p>Path for Pixelfed <code>bootstrap/cache</code> data.</p><p>Default: <code>${DOCKER_ALL_HOST_DATA_ROOT_PATH}/pixelfed/cache</code></p></li><li><p><code>DOCKER_REDIS_HOST_DATA_PATH</code></p><p>Path where <code>Redis</code> will store it&#39;s data.</p><p>Default: <code>${DOCKER_ALL_HOST_DATA_ROOT_PATH}/redis</code></p></li><li><p><code>DOCKER_DB_HOST_DATA_PATH</code></p><p>Path where your database (<code>MariaDB</code>) store it&#39;s data.</p><p>Default: <code>${DOCKER_ALL_HOST_DATA_ROOT_PATH}/db</code></p></li></ul><h3 id="_6-start-containers" tabindex="-1">6) Start containers <a class="header-anchor" href="#_6-start-containers" aria-label="Permalink to &quot;6) Start containers&quot;">‚Äã</a></h3><p>With all an updated Pixelfed (step 2), updated <code>.env</code> file (step 3), and migrated data (steps 4, 5, 6, and 7), we&#39;re ready to start things back up again.</p><p>But before we start your Pixelfed server, let&#39;s put the new <code>.env</code> file we made in step 1 in its proper place.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .env.new</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .env</span></span></code></pre></div><h4 id="the-database" tabindex="-1">The Database <a class="header-anchor" href="#the-database" aria-label="Permalink to &quot;The Database&quot;">‚Äã</a></h4><p>The first thing we want to try is to start up the database by running the following command and checking the logs:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 250</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --follow</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> db</span></span></code></pre></div><p>If there are no errors and the server isn&#39;t crashing, great! If you have an easy way of connecting to the database via a GUI or CLI client, do that as well and verify the database and tables are all there.</p><h4 id="redis" tabindex="-1">Redis <a class="header-anchor" href="#redis" aria-label="Permalink to &quot;Redis&quot;">‚Äã</a></h4><p>The next thing we want to try is to start up the Redis server by running the following command and checking the logs:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> redis</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 250</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --follow</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> redis</span></span></code></pre></div><p>if there are no errors and the server isn&#39;t crashing, great!</p><h4 id="worker" tabindex="-1">Worker <a class="header-anchor" href="#worker" aria-label="Permalink to &quot;Worker&quot;">‚Äã</a></h4><p>The next thing we want to try is to start up the Worker server by running the following command and checking the logs:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> worker</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 250</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --follow</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> worker</span></span></code></pre></div><p>The container should output a <em>lot</em> of logs from the <a href="./../customize.html#run-script-on-startup">docker-entrypoint system</a>, but <em>eventually</em> you should see these messages</p><ul><li><code>Configuration complete; ready for start up</code></li><li><code>Horizon started successfully.</code></li></ul><p>If you see one or both of those messages, the worker seems to be running.</p><p>If the worker is crash looping, inspect the logs and try to resolve the issues.</p><p>You can consider the following additional steps:</p><ul><li>Enabling <code>DOCKER_APP_ENTRYPOINT_DEBUG</code>, which will show even more log output to help understand what is going on</li><li>Enabling <code>DOCKER_APP_ENSURE_OWNERSHIP_PATHS</code> against the path(s) that might have permission issues</li><li>Fixing permission issues directly on the host since your data should all be in the <code>${DOCKER_ALL_HOST_DATA_ROOT_PATH}</code> folder (<code>./docker-compose-state/data</code> by default)</li></ul><h4 id="web" tabindex="-1">Web <a class="header-anchor" href="#web" aria-label="Permalink to &quot;Web&quot;">‚Äã</a></h4><p>The final service, <code>web,</code> will bring your site back online! What a journey it has been.</p><p>Let&#39;s get to it: run these commands to start the <code>web</code> service and inspect the logs.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> web</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 250</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --follow</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> web</span></span></code></pre></div><p>The output should be identical to that of the <code>worker</code>, so please see that section for debugging tips if the container is crash looping.</p><p>If the <code>web</code> service comes online without issues, start the rest of the (optional) services, such as the <code>proxy</code>, if enabled, by running:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 250</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --follow</span></span></code></pre></div><p>If you changed anything in the <code>.env</code> file while debugging, some containers might restart now; that&#39;s perfectly fine.</p><h3 id="_7-verify" tabindex="-1">7) Verify <a class="header-anchor" href="#_7-verify" aria-label="Permalink to &quot;7) Verify&quot;">‚Äã</a></h3><p>With all services online, it&#39;s time to go to your browser and check everything is working.</p><ol><li>Upload and post a picture</li><li>Comment on a post</li><li>Like a post</li><li>Check Horizon (<code>https://${APP_DOMAIN}/horizon</code>) for any errors</li><li>Check the Docker compose logs via <code>docker compose logs --follow</code></li></ol><p>If everything looks fine, yay, you made it to the end! Let us do some cleanup</p><h3 id="_8-cleanup" tabindex="-1">8) Cleanup <a class="header-anchor" href="#_8-cleanup" aria-label="Permalink to &quot;8) Cleanup&quot;">‚Äã</a></h3><p>With everything working, please take a new snapshot/backup of your server <em>before</em> we do any cleanup. A post-migration snapshot is handy since it contains both the old and new configuration + data, making any recovery much easier in a rollback scenario later.</p><p>Now, with all the data in the new folders, you can delete the old Docker Container volumes (if you want, completely optional)</p><p>List all volumes and give them a look:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> volume</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ls</span></span></code></pre></div><p>The volumes we want to delete <em>end</em> with the volume name (<code>db-data</code>, <code>app-storage</code>, <code>redis-data</code>, and <code>app-bootstrap</code>.) but have some prefixes in front of them.</p><p>Once you have found the volumes in in the list, delete each of them by running:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> volume</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rm</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $volume_name_in_column_two_of_the_output</span></span></code></pre></div><p>You can also delete the <code>docker-compose.yml.old</code> and <code>.env.old</code> files since they are no longer needed:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-compose.yml.old</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .env.old</span></span></code></pre></div><h2 id="rollback" tabindex="-1">Rollback <a class="header-anchor" href="#rollback" aria-label="Permalink to &quot;Rollback&quot;">‚Äã</a></h2><p>Oh no, something went wrong? No worries; you have backups and a quick way back!</p><h3 id="move-docker-compose-yml-back" tabindex="-1">Move <code>docker-compose.yml</code> back <a class="header-anchor" href="#move-docker-compose-yml-back" aria-label="Permalink to &quot;Move `docker-compose.yml` back&quot;">‚Äã</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-compose.yml</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-compose.yml.new</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-compose.yml.old</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> docker-compose.yml</span></span></code></pre></div><h3 id="move-env-file-back" tabindex="-1">Move <code>.env</code> file back <a class="header-anchor" href="#move-env-file-back" aria-label="Permalink to &quot;Move `.env` file back&quot;">‚Äã</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> env.old</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .env</span></span></code></pre></div><h3 id="go-back-to-the-old-source-code-version" tabindex="-1">Go back to the old source code version <a class="header-anchor" href="#go-back-to-the-old-source-code-version" aria-label="Permalink to &quot;Go back to the old source code version&quot;">‚Äã</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> checkout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $commit_id_from_step_0</span></span></code></pre></div><h3 id="start-things-back-up" tabindex="-1">Start things back up <a class="header-anchor" href="#start-things-back-up" aria-label="Permalink to &quot;Start things back up&quot;">‚Äã</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> compose</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> up</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span></span></code></pre></div><h3 id="verify-it-worked" tabindex="-1">Verify it worked <a class="header-anchor" href="#verify-it-worked" aria-label="Permalink to &quot;Verify it worked&quot;">‚Äã</a></h3><p>See <a href="#7-verify">Step 7</a> for recommended steps to verify everythin is working</p></div></div></main><footer class="VPDocFooter" data-v-e6f2a212 data-v-b4b63abf><!--[--><!--]--><!----><nav class="prev-next" data-v-b4b63abf><div class="pager" data-v-b4b63abf><a class="VPLink link pager-link prev" href="/docs/pr-preview/pr-1/running-pixelfed/docker/runtimes.html" data-v-b4b63abf><!--[--><span class="desc" data-v-b4b63abf>Previous page</span><span class="title" data-v-b4b63abf>Runtimes</span><!--]--></a></div><div class="pager" data-v-b4b63abf><a class="VPLink link pager-link next" href="/docs/pr-preview/pr-1/running-pixelfed/generic/prerequisites.html" data-v-b4b63abf><!--[--><span class="desc" data-v-b4b63abf>Next page</span><span class="title" data-v-b4b63abf>Prerequisites</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"readme.md\":\"L2hP20oz\",\"running-pixelfed_configuration.md\":\"v6m08her\",\"running-pixelfed_administration.md\":\"QSv192RK\",\"running-pixelfed_docker_installation.md\":\"lbrm9wiw\",\"running-pixelfed_cli-cheatsheet.md\":\"wIPk8Nkv\",\"running-pixelfed_troubleshooting.md\":\"9kPpxYqm\",\"running-pixelfed_docker_customize.md\":\"Bg63668R\",\"index.md\":\"cBS27OBk\",\"running-pixelfed_docker_runtimes.md\":\"e4IvfCrB\",\"running-pixelfed_docker_prerequisites.md\":\"Qjte4WrF\",\"running-pixelfed_generic_prerequisites.md\":\"g10XYLT1\",\"running-pixelfed_docker_faq.md\":\"oUEZ_7Vx\",\"running-pixelfed_docker_migrate_v2.0.md\":\"JtJSSBTP\",\"running-pixelfed_index.md\":\"u_xPL25n\",\"running-pixelfed_generic_installation.md\":\"0Jr0dQBV\",\"spec_activitypub.md\":\"3F-PCrZW\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Pixelfed Glitch Docs\",\"description\":\"The Pixelfed Glitch documentation\",\"base\":\"/docs/pr-preview/pr-1/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":{\"light\":\"/logo-black.png\",\"dark\":\"/logo-white.png\"},\"siteTitle\":\"Docs (Next)\",\"outline\":{\"level\":[2,3,4,5]},\"nav\":[{\"text\":\"pixelfed\",\"link\":\"https://pixelfed-glitch.github.io\"},{\"text\":\"Support\",\"link\":\"https://github.com/pixelfed-glitch/pixelfed/discussions\"}],\"search\":{\"provider\":\"local\"},\"i18nRouting\":false,\"sidebar\":[{\"text\":\"Running Pixelfed\",\"link\":\"/running-pixelfed/\",\"items\":[{\"text\":\"Docker\",\"items\":[{\"text\":\"Prerequisites\",\"link\":\"/running-pixelfed/docker/prerequisites\"},{\"text\":\"Installation\",\"link\":\"/running-pixelfed/docker/installation\"},{\"text\":\"Customize\",\"link\":\"/running-pixelfed/docker/customize\"},{\"text\":\"FAQ\",\"link\":\"/running-pixelfed/docker/faq\"},{\"text\":\"Runtimes\",\"link\":\"/running-pixelfed/docker/runtimes\"},{\"text\":\"Migrate to v2\",\"link\":\"/running-pixelfed/docker/migrate/v2.0\"}]},{\"text\":\"Generic\",\"items\":[{\"text\":\"Prerequisites\",\"link\":\"/running-pixelfed/generic/prerequisites\"},{\"text\":\"Installation\",\"link\":\"/running-pixelfed/generic//installation\"}]},{\"text\":\"Configuration\",\"link\":\"/running-pixelfed/configuration\"},{\"text\":\"Administration\",\"link\":\"/running-pixelfed/administration\"},{\"text\":\"CLI Cheatsheet\",\"link\":\"/running-pixelfed/cli-cheatsheet\"},{\"text\":\"Troubleshooting\",\"link\":\"/running-pixelfed/troubleshooting\"}]},{\"text\":\"Spec Compliance\",\"items\":[{\"text\":\"ActivityPub\",\"link\":\"/spec/ActivityPub\"}]}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/pixelfed\"},{\"icon\":\"discord\",\"link\":\"https://discord.gg/MHvDHaSzmc\"},{\"icon\":{\"svg\":\"<svg width=\\\"20\\\" height=\\\"20\\\" version=\\\"1.1\\\" id=\\\"svg161\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" xmlns:svg=\\\"http://www.w3.org/2000/svg\\\"> <defs id=\\\"defs165\\\" /> <path d=\\\"M 10,20 C 4.4772,20 0,15.5228 0,10 0,4.4772 4.4772,0 10,0 15.5228,0 20,4.4772 20,10 20,15.5228 15.5228,20 10,20 Z M 9.206,12.1832 h 1.8344 c 1.728,0 3.1292,-1.364 3.1292,-3.046 0,-1.6824 -1.4008,-3.0464 -3.1292,-3.0464 H 8.3928 c -0.9968,0 -1.8052,0.7868 -1.8052,1.7576 v 6.84 z\\\" fill-rule=\\\"evenodd\\\" id=\\\"path159\\\" style=\\\"stroke-width:0.4\\\" /></svg>\"},\"link\":\"https://pixelfed.social/@pixelfed\"},{\"icon\":\"mastodon\",\"link\":\"https://mastodon.social/@pixelfed\"}]},\"locales\":{\"root\":{\"label\":\"English\",\"lang\":\"en\"}},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>